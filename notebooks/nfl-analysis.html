<!doctype html>
<notebook theme="air">
  <title>NFL Games Analysis</title>
  <script id="1" type="text/markdown">
# NFL Games Analysis

    Fetching recent NFL games from ESPN and visualizing scores and team performance.
  </script>
  <script id="2" type="application/vnd.observable.javascript">
// Fetch recent NFL games from ESPN API (multiple weeks)
    games = {
      // Fetch weeks 14, 15, 16 for completed games
      const weeks = [14, 15, 16];
      const allGames = [];

      for (const week of weeks) {
    const response = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard?week=${week}`);
    const data = await response.json();
    const weekGames = data.events.map(event => {
      const competition = event.competitions[0];
      const home = competition.competitors.find(c => c.homeAway === "home");
      const away = competition.competitors.find(c => c.homeAway === "away");
      return {
        id: event.id,
        week: week,
        name: event.name,
        date: new Date(event.date),
        status: event.status.type.description,
        homeTeam: home.team.displayName,
        homeAbbr: home.team.abbreviation,
        homeScore: parseInt(home.score) || 0,
        awayTeam: away.team.displayName,
        awayAbbr: away.team.abbreviation,
        awayScore: parseInt(away.score) || 0,
        venue: competition.venue?.fullName || "TBD"
      };
    });
    allGames.push(...weekGames);
      }
      return allGames;
    }
  </script>
  <script id="3" type="text/markdown">
## Recent Games (Weeks 14-16)

    ${games.length} games found. Completed: ${games.filter(g => g.status === "Final").length}
  </script>
  <script id="4" type="application/vnd.observable.javascript" pinned>
// Games table (completed games only)
    Inputs.table(games.filter(g => g.status === "Final"), {
      columns: ["week", "awayTeam", "awayScore", "homeScore", "homeTeam"],
      header: {
    week: "Wk",
    awayTeam: "Away",
    awayScore: "Away",
    homeScore: "Home",
    homeTeam: "Home Team"
      }
    })
  </script>
  <script id="5" type="application/vnd.observable.javascript" pinned>
// Filter to completed games only
    completedGames = games.filter(g => g.status === "Final")
  </script>
  <script id="6" type="text/markdown">
## Score Comparison (Week 15)

    Comparing home vs away scores. Blue = home, Red = away.
  </script>
  <script id="7" type="application/vnd.observable.javascript" pinned>
// Score comparison chart (Week 15 only for readability)
    {
      const week15 = completedGames.filter(g => g.week === 15);
      return Plot.plot({
    marginLeft: 100,
    marginRight: 60,
    height: week15.length * 35 + 60,
    x: {label: "Score"},
    y: {label: null},
    marks: [
      Plot.barX(week15, {
        y: d => `${d.awayAbbr} @ ${d.homeAbbr}`,
        x: "homeScore",
        fill: "#2563eb",
        title: d => `${d.homeTeam}: ${d.homeScore}`
      }),
      Plot.barX(week15, {
        y: d => `${d.awayAbbr} @ ${d.homeAbbr}`,
        x: d => -d.awayScore,
        fill: "#dc2626",
        title: d => `${d.awayTeam}: ${d.awayScore}`
      }),
      Plot.ruleX([0])
    ]
      });
    }
  </script>
  <script id="8" type="text/markdown">
## Points Distribution

    Total points scored per game, colored by margin of victory.
  </script>
  <script id="9" type="application/vnd.observable.javascript" pinned>
// Total points histogram
    Plot.plot({
      height: 300,
      x: {label: "Total Points"},
      y: {label: "Number of Games"},
      marks: [
    Plot.rectY(completedGames, Plot.binX({y: "count"}, {
      x: d => d.homeScore + d.awayScore,
      fill: "steelblue"
    })),
    Plot.ruleY([0])
      ]
    })
  </script>
  <script id="10" type="text/markdown">
## Margin of Victory

    How close are games?
  </script>
  <script id="11" type="application/vnd.observable.javascript" pinned>
// Margin of victory histogram
    Plot.plot({
      height: 300,
      x: {label: "Margin of Victory (points)"},
      y: {label: "Number of Games"},
      color: {legend: true},
      marks: [
    Plot.rectY(completedGames, Plot.binX({y: "count"}, {
      x: d => Math.abs(d.homeScore - d.awayScore),
      fill: d => Math.abs(d.homeScore - d.awayScore) <= 7 ? "Close Game" : "Decisive"
    })),
    Plot.ruleY([0])
      ]
    })
  </script>
  <script id="12" type="text/markdown">
## Summary Stats
  </script>
  <script id="13" type="application/vnd.observable.javascript">
({
      "Total Games": games.length,
      "Completed": completedGames.length,
      "Avg Total Points": completedGames.length ? (completedGames.reduce((sum, g) => sum + g.homeScore + g.awayScore, 0) / completedGames.length).toFixed(1) : "N/A",
      "Avg Margin": completedGames.length ? (completedGames.reduce((sum, g) => sum + Math.abs(g.homeScore - g.awayScore), 0) / completedGames.length).toFixed(1) : "N/A",
      "Home Wins": completedGames.filter(g => g.homeScore > g.awayScore).length,
      "Away Wins": completedGames.filter(g => g.awayScore > g.homeScore).length
    })
  </script>
</notebook>
